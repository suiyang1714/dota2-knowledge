{"version":3,"sources":["webpack:///webpack/bootstrap dcd786e019c3d09974b5","webpack:///external \"mongoose\"","webpack:///./~/babel-runtime/regenerator/index.js","webpack:///./server/database/schema/question.js","webpack:///./server/database/schema/record.js","webpack:///./server/database/schema/temporaryrecord.js","webpack:///./server/database/schema/user.js","webpack:///./server/config/index.js","webpack:///./server/database/schema/admin.js","webpack:///./nuxt.config.js","webpack:///./server/database/database.js","webpack:///./server/router/index.js","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-session\"","webpack:///external \"koa2-cors\"","webpack:///external \"nuxt\"","webpack:///./server/middleware/WXBizDataCrypt.js","webpack:///./server/database/schema ^\\.\\/.*$","webpack:///external \"bcryptjs\"","webpack:///external \"crypto\"","webpack:///external \"flyio/src/node\"","webpack:///external \"fs\"","webpack:///external \"koa-router\"","webpack:///external \"path\"","webpack:///external \"regenerator-runtime\"","webpack:///./server/index.js"],"names":["mongoose","require","Schema","QuestionSchema","issue","String","options","type","Array","answer","Number","completed","ref","level","default","meta","createdAt","Date","now","updatedAt","pre","next","isNew","Question","model","module","exports","RecordSchema","openid","victory","failure","highLadder","winStreak","Record","TemporaryRecordSchema","issueId","userId","TemporaryRecord","UserSchema","avatarUrl","nickname","role","unionid","province","country","city","gender","record","MinaUser","config","db","appid","appsecret","bcrypt","SALT_WORK_FACTOR","MAX_LOGIN_ATTEMPTS","LOCK_TIME","AdminSchema","user","password","isModified","genSalt","err","salt","hash","error","methods","comparePassword","_password","Promise","resolve","reject","compare","isMatch","incLoginAttempts","that","lockUntil","update","$set","loginAttempts","$unset","updates","$inc","isLocked","Admin","head","title","charset","name","content","hid","link","rel","href","css","loading","color","plugins","build","extend","ctx","isClient","rules","push","enforce","test","loader","exclude","fs","models","__dirname","readdirSync","filter","file","search","forEach","database","set","global","connect","connection","on","console","log","findOne","save","router","WXBizDataCrypt","flyio","fly","post","code","request","body","url","get","callback","openId","JSON","parse","data","exec","success","stored","errmsg","populate","encryptedData","iv","sessionKey","pc","decryptData","nickName","unionId","_id","issueMsg","query","issueIdArray","questions","find","temporaryrecord","length","map","item","$nin","random","Math","floor","newTemporaryRecord","result","findById","remove","username","match","Error","session","crypto","appId","prototype","Buffer","from","decipher","createDecipheriv","setAutoPadding","decoded","final","watermark","app","host","process","env","HOST","port","PORT","dev","nuxt","builder","use","cors","origin","exposeHeaders","maxAge","credentials","allowMethods","allowHeaders","bodyParser","mongodb","keys","CONFIG","key","overwrite","httpOnly","signed","rolling","filmApi","routes","allowedMethods","status","req","res","render","promise","then","catch","listen","start"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 25);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap dcd786e019c3d09974b5","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/regenerator/index.js\n// module id = 1\n// module chunks = 0","const mongoose = require('mongoose')\nconst Schema = mongoose.Schema\n\nconst QuestionSchema = new Schema({\n  issue: String,\n  options: {\n    type: Array\n  },\n  answer: {\n    type: Number\n  },\n  completed: [\n    {\n      type: String,\n      ref: 'MinaUser'\n    }\n  ],\n  level: {\n    type: Number,\n    default: 1\n  },\n  meta: {\n    createdAt: {\n      type: Date,\n      default: Date.now()\n    },\n    updatedAt: {\n      type: Date,\n      default: Date.now()\n    }\n  }\n})\n\nQuestionSchema.pre('save', function (next) {\n  if (this.isNew) {\n    this.meta.createdAt = this.meta.updatedAt = Date.now()\n  } else {\n    this.meta.updatedAt = Date.now()\n  }\n\n  next()\n})\n\nconst Question = mongoose.model('Question', QuestionSchema)\n\nmodule.exports = Question\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/schema/question.js","const mongoose = require('mongoose')\nconst Schema = mongoose.Schema\n\nconst RecordSchema = new Schema({\n  openid: String,\n  victory: {\n    type: Number,\n    default: 0\n  },\n  failure: {\n    type: Number,\n    default: 0\n  },\n  highLadder: {\n    type: Number,\n    default: 1000\n  },\n  winStreak: {\n    type: Number,\n    default: 0\n  },\n  meta: {\n    createdAt: {\n      type: Date,\n      default: Date.now()\n    },\n    updatedAt: {\n      type: Date,\n      default: Date.now()\n    }\n  }\n})\n\nRecordSchema.pre('save', function (next) {\n  if (this.isNew) {\n    this.meta.createdAt = this.meta.updatedAt = Date.now()\n  } else {\n    this.meta.updatedAt = Date.now()\n  }\n\n  next()\n})\n\nconst Record = mongoose.model('Record', RecordSchema)\n\nmodule.exports = Record\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/schema/record.js","const mongoose = require('mongoose')\nconst Schema = mongoose.Schema\n\nconst TemporaryRecordSchema = new Schema({\n  issueId: String,\n  userId: String,\n  meta: {\n    createdAt: {\n      type: Date,\n      default: Date.now()\n    },\n    updatedAt: {\n      type: Date,\n      default: Date.now()\n    }\n  }\n})\n\nTemporaryRecordSchema.pre('save', function (next) {\n  if (this.isNew) {\n    this.meta.createdAt = this.meta.updatedAt = Date.now()\n  } else {\n    this.meta.updatedAt = Date.now()\n  }\n\n  next()\n})\n\nconst TemporaryRecord = mongoose.model('TemporaryRecord', TemporaryRecordSchema)\n\nmodule.exports = TemporaryRecord\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/schema/temporaryrecord.js","const mongoose = require('mongoose')\nconst Schema = mongoose.Schema\n\nconst UserSchema = new Schema({\n  openid: String,\n  avatarUrl: String,\n  nickname: String,\n  role: {\n    type: String,\n    default: 'user'\n  },\n  unionid: String,\n  province: String,\n  country: String,\n  city: String,\n  gender: String,\n  record: {\n    type: String,\n    ref: 'Record'\n  },\n  meta: {\n    createdAt: {\n      type: Date,\n      default: Date.now()\n    },\n    updatedAt: {\n      type: Date,\n      default: Date.now()\n    }\n  }\n})\n\nUserSchema.pre('save', function (next) {\n  if (this.isNew) {\n    this.meta.createdAt = this.meta.updatedAt = Date.now()\n  } else {\n    this.meta.updatedAt = Date.now()\n  }\n\n  next()\n})\n\nconst MinaUser = mongoose.model('MinaUser', UserSchema)\n\nmodule.exports = MinaUser\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/schema/user.js","const config = {\n  db:'mongodb://127.0.0.1/dotamina',\n  appid: 'wxff809823ead99d17',\n  appsecret: '0d1ce506638e6f1c0b05f99417775121'\n}\n\nmodule.exports = config\n\n\n\n// WEBPACK FOOTER //\n// ./server/config/index.js","const mongoose = require('mongoose')\nconst bcrypt = require('bcryptjs')\n\nconst SALT_WORK_FACTOR = 10\nconst MAX_LOGIN_ATTEMPTS = 5\nconst LOCK_TIME = 2 * 60 * 60 * 1000\nconst Schema = mongoose.Schema\n\nconst AdminSchema = new Schema({\n  user: String,\n  password: String,\n  nickname: String,\n  role: {\n    type: String,\n    default: 'user'\n  },\n  meta: {\n    createdAt: {\n      type: Date,\n      default: Date.now()\n    },\n    updatedAt: {\n      type: Date,\n      default: Date.now()\n    }\n  }\n})\n\nAdminSchema.pre('save', function(next) {\n  if (this.isNew) {\n    this.meta.createdAt = this.meta.updatedAt = Date.now()\n  } else {\n    this.meta.updatedAt = Date.now()\n  }\n\n  next()\n})\n\nAdminSchema.pre('save', function(next) {\n  var user = this\n\n  if (!user.isModified('password')) return next()\n\n  bcrypt.genSalt(SALT_WORK_FACTOR, (err, salt) => {\n    if (err) return next(err)\n    bcrypt.hash(user.password, salt, (error, hash) => {\n      if (error) return next(error)\n\n      user.password = hash\n      next()\n    })\n  })\n})\n\nAdminSchema.methods = {\n  comparePassword: function (_password, password) {\n    return new Promise((resolve, reject) => {\n      bcrypt.compare(_password, password, function(err, isMatch) {\n        if (!err) resolve(isMatch)\n        else reject(err)\n      })\n    })\n  },\n\n  incLoginAttempts: function (user) {\n    var that = this\n\n    return new Promise((resolve, reject) => {\n      if (that.lockUntil && that.lockUntil < Date.now()) {\n        that.update({\n          $set: {\n            loginAttempts: 1\n          },\n          $unset: {\n            lockUntil: 1\n          }\n        }, function(err) {\n          if (!err) resolve(true)\n          else reject(err)\n        })\n      }\n      var updates = {\n        $inc: {\n          loginAttempts: 1\n        }\n      }\n      if (that.loginAttempts + 1 >= MAX_LOGIN_ATTEMPTS && !that.isLocked) {\n        updates.$set = {\n          lockUntil: Date.now() + LOCK_TIME\n        }\n      }\n\n      that.update(updates, err => {\n        if (!err) resolve(true)\n        else reject(err)\n      })\n    })\n  }\n}\n\nconst Admin = mongoose.model('Admin', AdminSchema)\n\nmodule.exports = Admin\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/schema/admin.js","module.exports = {\n  /*\n  ** Headers of the page\n  */\n  head: {\n    title: 'starter',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { hid: 'description', name: 'description', content: 'Nuxt.js project' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n    ]\n  },\n  /*\n  ** Global CSS\n  */\n  css: [\n    '~assets/css/main.css',\n    'element-ui/lib/theme-chalk/reset.css',\n    'element-ui/lib/theme-chalk/index.css',\n  ],\n  /*\n  ** Customize the progress-bar color\n  */\n  loading: { color: '#3B8070' },\n  /*\n   ** Build configuration\n   */\n  plugins: [\n    '~plugins/element-ui'\n  ],\n  build: {\n    /*\n     ** Run ESLINT on save\n     */\n    extend (config, ctx) {\n      if (ctx.isClient) {\n        config.module.rules.push({\n          enforce: 'pre',\n          test: /\\.(js|vue)$/,\n          loader: 'eslint-loader',\n          exclude: /(node_modules)/\n        })\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","var fs = require('fs')\nvar resolve = require('path').resolve\nvar mongoose = require('mongoose')\nvar config = require('../config')\n\n/*const models = resolve(__dirname, './schema')\nfs.readdirSync(models)\n  .filter(file => ~file.search(/^[^\\.].*js$/))\n  .forEach(file => require(resolve(models, file)))*/\nconst models = resolve(__dirname, '../database/schema')\nfs.readdirSync(models)\n  .filter(file => ~file.search(/^[^\\.].*js$/))\n  .forEach(file => {\n    require(`../database/schema/${file}`)\n    // require(resolve(models,file))\n  })\n\nconst database = () => {\n\n    mongoose.set('debug', true)\n\n    mongoose.Promise = global.Promise\n\n    mongoose.connect(config.db)\n\n    mongoose.connection.on('disconnected', () => {\n        mongoose.connect(config.db)\n    })\n    mongoose.connection.on('error', err => {\n        console.error(err)\n    })\n\n    mongoose.connection.on('open', async () => {\n\n      console.log('Connected to MongoDB ', config.db)\n\n      const Admin = mongoose.model('Admin')\n      let user = await Admin.findOne({\n        user: 'admin'\n      })\n\n      if (!user) {\n        console.log('写入管理员数据')\n\n        user = new Admin({\n          user: 'admin',\n          password: '123456',\n          role: 'superAdmin',\n          nickname: 'Aditya Sui'\n        })\n\n        await user.save()\n      }\n\n    })\n\n}\n\nmodule.exports = database\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/database.js","const router = require('koa-router')()\nconst WXBizDataCrypt = require('../middleware/WXBizDataCrypt')\nconst config = require('../config')\nconst flyio = require(\"flyio/src/node\")\nconst fly = new flyio\n\nconst Admin = require('../database/schema/admin')\nconst MinaUser = require('../database/schema/user')\nconst Record = require('../database/schema/record')\nconst Question = require('../database/schema/question')\nconst TemporaryRecord = require('../database/schema/temporaryrecord')\n\nrouter.post('/api/UserWechat/login', async (ctx, next) => {\n  const { code } = ctx.request.body\n  const url = `https://api.weixin.qq.com/sns/jscode2session?appid=${config.appid}&secret=${config.appsecret}&js_code=${code}&grant_type=authorization_code`\n\n  const callback = await fly.get(url)\n  const openId = JSON.parse(callback.data).openid\n  let user\n  user = await MinaUser\n    .findOne({openid: openId})\n    .exec()\n  if (!user) {\n    let user = await new MinaUser({\n      openid: openId\n    })\n\n    await user.save()\n\n    ctx.body = {\n      success: true,\n      stored: false,\n      errmsg: `新建用户 openid`,\n      data: JSON.parse(callback.data)\n    }\n  } else {\n    user = await MinaUser\n      .findOne({openid: openId})\n      .populate('record')\n      .exec()\n    ctx.body = {\n      success: true,\n      stored: true,\n      errmsg: `该用户信息已存在`,\n      data: user\n    }\n  }\n})\n\nrouter.post('/api/UserWechat/ValidateUser', async (ctx, next) => {\n  const { encryptedData, iv, sessionKey } = ctx.request.body\n  const pc = new WXBizDataCrypt(config.appid, sessionKey)\n  const data = pc.decryptData(encryptedData , iv)\n  let user\n  user = await MinaUser\n    .findOne({openid: data.openId})\n    .exec()\n\n  if (user) {\n    let record = new Record({\n      openid: data.openId\n    })\n    user.nickname = data.nickName\n    user.gender = data.gender\n    user.city = data.city\n    user.province = data.province\n    user.country = data.country\n    user.avatarUrl = data.avatarUrl\n    user.unionId = data.unionId\n    user.record = record._id\n\n    await user.save()\n    await record.save()\n\n    user = await MinaUser\n      .findOne({openid: data.openId})\n      .populate('record')\n      .exec()\n\n    ctx.body = {\n      success: true,\n      errmsg: `用户信息存储成功`,\n      data: user\n    }\n  } else {\n    ctx.body = {\n      success: false,\n      errmsg: `用户信息存储失败`,\n      data: null\n    }\n  }\n})\nrouter.post('/api/question/new', async (ctx, next) => {\n  const issueMsg = ctx.request.body\n\n  let issue = await new Question(issueMsg)\n\n  issue.save()\n\n  ctx.body = {\n    success: true,\n    data: `提交成功，感谢您的题目！`\n  }\n\n})\nrouter.get('/api/getQuestion', async (ctx, next) => {\n  const { openid } = ctx.query\n  let issueIdArray\n  let questions\n\n  const temporaryrecord = await TemporaryRecord\n    .find({userId: openid})\n    .exec()\n\n  if (temporaryrecord.length > 0) {\n    issueIdArray = temporaryrecord.map(item => {\n      return item.issueId\n    })\n    console.log(issueIdArray)\n    questions = await Question\n      .find({\n        completed: {\n          $nin: [openid]\n        },\n        _id: {\n          $nin: issueIdArray\n        }\n      })\n      .exec()\n  } else {\n    questions = await Question\n      .find({\n        completed: {\n          $nin: [openid]\n        }\n      })\n      .exec()\n  }\n\n  if (questions.length > 0) {\n    const random = Math.floor(Math.random() * questions.length)\n\n    const newTemporaryRecord = await new TemporaryRecord({\n      issueId: questions[random]._id,\n      userId: openid\n    })\n\n    await newTemporaryRecord.save()\n\n    ctx.body = {\n      success: true,\n      errmsg: `这是第${issueIdArray ? issueIdArray.length + 1 : 1}道题`,\n      data: questions[random]\n    }\n  } else {\n    ctx.body = {\n      success: true,\n      errmsg: `我周雄谁都不服就服你`,\n      data: null\n    }\n  }\n\n})\nrouter.get('/api/updateRecord', async (ctx, next) => {\n  const { openid, result, issueId } = ctx.query\n\n  let record = await Record\n    .findOne({openid: openid})\n    .exec()\n\n  if (result === 'true') {\n    let issue = await Question\n      .findById({_id: issueId})\n      .exec()\n\n    record.victory += 1\n    record.highLadder += issue.level * 1\n\n    issue.completed.push(openid)\n    await issue.save()\n  } else if (result === 'false') {\n    record.failure += 1\n    record.highLadder -= 1\n  }\n  await record.save()\n\n  ctx.body = {\n    success: true,\n    data: record\n  }\n\n})\nrouter.get('/api/delete/temporary', async (ctx, next) => {\n  const { openid } = ctx.query\n\n  await TemporaryRecord\n    .remove({userId: openid})\n    .exec()\n\n  ctx.body = {\n    success: true,\n    errmsg: `临时记录清除成功`,\n    data: null\n  }\n})\n// 登录\nrouter.post('/api/login', async (ctx, next) => {\n  const { username, password } = ctx.request.body\n  let user,\n    match\n\n  try {\n    user = await Admin.findOne({ user: username }).exec()\n    if (user) {\n      match = await user.comparePassword(password, user.password)\n    }\n  } catch (e) {\n    throw new Error(e)\n  }\n\n  if (match) {\n    ctx.session.user = {\n      _id: user._id,\n      username: user.user,\n      nickname: user.nickname,\n      role: user.role\n    }\n\n    return (ctx.body = {\n      success: true,\n      data: {\n        username: user.user,\n        nickname: user.nickname\n      }\n    })\n  }\n\n  return (ctx.body = {\n    success: false,\n    err: '密码错误'\n  })\n})\nmodule.exports = router\n\n\n\n// WEBPACK FOOTER //\n// ./server/router/index.js","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"koa-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-session\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"koa2-cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa2-cors\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 15\n// module chunks = 0","var crypto = require('crypto')\n\nfunction WXBizDataCrypt(appId, sessionKey) {\n  this.appId = appId\n  this.sessionKey = sessionKey\n}\n\nWXBizDataCrypt.prototype.decryptData = function (encryptedData, iv) {\n  // base64 decode\n  var sessionKey = new Buffer.from(this.sessionKey, 'base64')\n  encryptedData = new Buffer.from(encryptedData, 'base64')\n  iv = new Buffer.from(iv, 'base64')\n\n  try {\n    // 解密\n    var decipher = crypto.createDecipheriv('aes-128-cbc', sessionKey, iv)\n    // 设置自动 padding 为 true，删除填充补位\n    decipher.setAutoPadding(true)\n    var decoded = decipher.update(encryptedData, 'binary', 'utf8')\n    decoded += decipher.final('utf8')\n\n    decoded = JSON.parse(decoded)\n\n  } catch (err) {\n    throw new Error('Illegal Buffer')\n  }\n\n  if (decoded.watermark.appid !== this.appId) {\n    throw new Error('Illegal Buffer')\n  }\n\n  return decoded\n}\n\nmodule.exports = WXBizDataCrypt\n\n\n\n// WEBPACK FOOTER //\n// ./server/middleware/WXBizDataCrypt.js","var map = {\n\t\"./admin\": 7,\n\t\"./admin.js\": 7,\n\t\"./question\": 2,\n\t\"./question.js\": 2,\n\t\"./record\": 3,\n\t\"./record.js\": 3,\n\t\"./temporaryrecord\": 4,\n\t\"./temporaryrecord.js\": 4,\n\t\"./user\": 5,\n\t\"./user.js\": 5\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) // check for number\n\t\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n\treturn id;\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 17;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/database/schema ^\\.\\/.*$\n// module id = 17\n// module chunks = 0","module.exports = require(\"bcryptjs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcryptjs\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"flyio/src/node\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"flyio/src/node\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 22\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 23\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 24\n// module chunks = 0","import Koa from 'koa'\nimport { Nuxt, Builder } from 'nuxt'\n\n// after end\n\nimport session from 'koa-session'\n\nimport cors from 'koa2-cors'\n\nconst filmApi = require('./router')\nconst mongodb = require('./database/database')\nconst bodyParser = require('koa-bodyparser')\n\n\nasync function start () {\n  const app = new Koa()\n  const host = process.env.HOST || '127.0.0.1'\n  const port = process.env.PORT || 7278\n\n  // Import and Set Nuxt.js options\n  let config = require('../nuxt.config.js')\n  config.dev = !(app.env === 'production')\n\n  // Instantiate nuxt.js\n  const nuxt = new Nuxt(config)\n\n  // Build in development\n  if (config.dev) {\n    const builder = new Builder(nuxt)\n    await builder.build()\n  }\n  app.use(cors({\n    origin: function (ctx) {\n      return 'http://localhost:7998'\n    },\n    exposeHeaders: ['WWW-Authenticate', 'Server-Authorization'],\n    maxAge: 5,\n    credentials: true,\n    allowMethods: ['GET', 'POST', 'DELETE'],\n    allowHeaders: ['Content-Type', 'Authorization', 'Accept']\n  }))\n  // body-parser\n  app.use(bodyParser())\n\n  // mongodb\n  mongodb()\n\n  // session\n  app.keys = ['some session']\n\n  const CONFIG = {\n    key: 'SESSION', /** (string) cookie key (default is koa:sess) */\n    /** (number || 'session') maxAge in ms (default is 1 days) */\n    /** 'session' will result in a cookie that expires when session/browser is closed */\n    /** Warning: If a session cookie is stolen, this cookie will never expire */\n    maxAge: 86400000,\n    overwrite: true, /** (boolean) can overwrite or not (default true) */\n    httpOnly: true, /** (boolean) httpOnly or not (default true) */\n    signed: true, /** (boolean) signed or not (default true) */\n    rolling: false /** (boolean) Force a session identifier cookie to be set on every response. The expiration is reset to the original maxAge, resetting the expiration countdown. default is false **/\n  }\n  app.use(session(CONFIG, app))\n\n  // routes\n  app.use(filmApi.routes(), filmApi.allowedMethods())\n\n  app.use(async (ctx, next) => {\n    await next()\n    ctx.status = 200 // koa defaults to 404 when it sees that status is unset\n    ctx.req.session = ctx.session\n    return new Promise((resolve, reject) => {\n      ctx.res.on('close', resolve)\n      ctx.res.on('finish', resolve)\n      nuxt.render(ctx.req, ctx.res, promise => {\n        // nuxt.render passes a rejected promise into callback on error.\n        promise.then(resolve).catch(reject)\n      })\n    })\n  })\n\n  app.listen(port, host)\n  console.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n}\n\nstart()\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js"],"sourceRoot":""}